<%- contentFor('hero') %>

<% var sev1count = 0, sev2count = 0, sev3count = 0, sev4count = 0%>
<% var status1count = 0, status2count = 0, status3count = 0, status4count = 0,
status5count = 0,status6count = 0,status7count = 0%>
<% for (var i = 0; i < defects.length; i++) { %>
    <tr class="data">
            <%if (defects[i].severity=='Severity1') {%>
            <% sev1count = sev1count + 1 %>  
            <%}%>
            <%if (defects[i].severity=='Severity2') {%>
            <% sev2count = sev2count + 1 %>  
            <%}%>
            <%if (defects[i].severity=='Severity3') {%>
            <% sev3count = sev3count + 1 %>  
            <%}%>
            <%if (defects[i].severity=='Severity4') {%>
            <% sev4count = sev4count + 1 %>  
            <%}%>

            <%if (defects[i].status=='new') {%>
            <% status1count = status1count + 1 %>  
            <%}%>
            <%if (defects[i].status=='assigned') {%>
            <% status2count = status2count + 1 %>  
            <%}%>
            <%if (defects[i].status=='open') {%>
            <% status3count = status3count + 1 %>  
            <%}%>
            <%if (defects[i].status=='fixed') {%>
            <% status4count = status4count + 1 %>  
            <%}%>
            <%if (defects[i].status=='retest') {%>
            <% status5count = status5count + 1 %>  
            <%}%>
            <%if (defects[i].status=='reopen') {%>
            <% status6count = status6count + 1 %>  
            <%}%>
            <%if (defects[i].status=='closed') {%>
            <% status7count = status7count + 1 %>  
            <%}%>
    </tr>
<% } %>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    
      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart','bar']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawChart);

       var chartdata1 = <%- JSON.stringify(sev1count)%>;
       var chartdata2 = <%- JSON.stringify(sev2count)%>;
       var chartdata3 = <%- JSON.stringify(sev3count)%>;
       var chartdata4 = <%- JSON.stringify(sev4count)%>;

       var barchartdata1 = <%- JSON.stringify(status1count)%>;
       var barchartdata2 = <%- JSON.stringify(status2count)%>;
       var barchartdata3 = <%- JSON.stringify(status3count)%>;
       var barchartdata4 = <%- JSON.stringify(status4count)%>;
       var barchartdata5 = <%- JSON.stringify(status5count)%>;
       var barchartdata6 = <%- JSON.stringify(status6count)%>;
       var barchartdata7 = <%- JSON.stringify(status7count)%>;
    

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {

        // Create the data table.
        var data = new google.visualization.DataTable();
        console.log("Inside Java Script");        

        data.addColumn('string', 'Severity');
        data.addColumn('number', 'count');
        //data.addRows(chartData);
        data.addRows([
          ['Severity 1', chartdata1],
          ['Severity 2', chartdata2],
          ['Severity 3', chartdata3],
          ['Severity 4', chartdata4]
        ]);

        // Set chart options
        var options = {'title':'Defects Severity',
                       'width':1200, 
                       'height':400};

        // Instantiate and draw chart, passing in some options.
        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
        chart.draw(data, options);

        var barchartdata = new google.visualization.DataTable();
        barchartdata.addColumn('string', 'Status');
        barchartdata.addColumn('number', 'count');

        barchartdata.addRows([
          ['New', barchartdata1],
          ['Assigned', barchartdata2],
          ['Open', barchartdata3],
          ['Fixed', barchartdata4],
          ['Retest', barchartdata5],
          ['ReOpen', barchartdata6],
          ['Closed', barchartdata7]
        ]);

        var options = {
        title: 'Defects Status',
        hAxis: {
          title: 'Defect Status',
          viewWindow: {
            min: [7, 30, 0],
            max: [17, 30, 0]
          }
        },
        vAxis: {
          title: 'Total'
        }
      };

        var barchart = new google.visualization.ColumnChart(document.getElementById('barchart'));
        barchart.draw(barchartdata, options);

        
      }
    </script>



  <body>
    <!--Div that will hold the pie chart-->
    <div id="chart_div"></div>
    <div id="barchart"></div>


  </body>